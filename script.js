collection=[{"name":"20240630_0384_pano.jpg","tags":["panoramic","website"],"heightRatio":0.352764},{"name":"20240707_0003.jpg","tags":["anna","nyc","website"],"heightRatio":0.748276},{"name":"20240707_0011.jpg","tags":["nyc","website"],"heightRatio":0.727192},{"name":"20240707_0027.jpg","tags":["critters","nyc","website"],"heightRatio":0.666667},{"name":"20240707_0038.jpg","tags":["critters","nyc","website"],"heightRatio":0.666667},{"name":"20240707_0048.jpg","tags":["nyc","website"],"heightRatio":1.33641},{"name":"20240707_0177.jpg","tags":["longbranch","nj","website"],"heightRatio":0.748276},{"name":"20240715_0027.jpg","tags":["nyc","website"],"heightRatio":1.337},{"name":"20240715_0089.jpg","tags":["nyc","website"],"heightRatio":0.5},{"name":"20240719_0037.jpg","tags":["nyc","website"],"heightRatio":1.33641},{"name":"20240719_0043.jpg","tags":["nyc","website"],"heightRatio":1.33641},{"name":"20240719_0075.jpg","tags":["nyc","website"],"heightRatio":1.16724},{"name":"20240719_0078.jpg","tags":["nyc","website"],"heightRatio":0.857069},{"name":"20240719_0097.jpg","tags":["nyc","website"],"heightRatio":0.499777},{"name":"20240719_0137.jpg","tags":["nyc","website"],"heightRatio":1.33641},{"name":"20240728_0014.jpg","tags":["anna","pnw"],"heightRatio":1.33641},{"name":"20240728_0036.jpg","tags":["anna","pnw"],"heightRatio":0.732419},{"name":"20240728_0074.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0081.jpg","tags":["critters","pnw"],"heightRatio":0.748276},{"name":"20240728_0089.jpg","tags":["pnw"],"heightRatio":0.748269},{"name":"20240728_0111.jpg","tags":["anna","pnw"],"heightRatio":1.16656},{"name":"20240728_0114.jpg","tags":["anna","pnw"],"heightRatio":1.16667},{"name":"20240728_0255.jpg","tags":["anna","pnw"],"heightRatio":0.748276},{"name":"20240728_0293.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0334.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0398.jpg","tags":["pnw"],"heightRatio":0.748276},{"name":"20240728_0470.jpg","tags":["critters","pnw"],"heightRatio":0.748276},{"name":"20240728_0508.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0540.jpg","tags":["critters","pnw"],"heightRatio":0.748276},{"name":"20240728_0617.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0621.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0622.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0669.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0691.jpg","tags":["critters","pnw"],"heightRatio":1.33641},{"name":"20240728_0704.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0727.jpg","tags":["pnw"],"heightRatio":1.33665},{"name":"20240728_0734.jpg","tags":["anna","pnw"],"heightRatio":1.33641},{"name":"20240728_0741.jpg","tags":["pnw"],"heightRatio":1.33641},{"name":"20240728_0755.jpg","tags":["pnw"],"heightRatio":0.748276},{"name":"20240728_0830.jpg","tags":["pnw"],"heightRatio":0.748109},{"name":"20240728_0899.jpg","tags":["pnw"],"heightRatio":0.740401},{"name":"20240728_0980.jpg","tags":["pnw"],"heightRatio":1.16676},{"name":"20240804_0089.jpg","tags":["archive","nyc","website"],"heightRatio":1.45574},{"name":"20240804_0154.jpg","tags":["archive","nyc","website"],"heightRatio":1},{"name":"20240809_0045_pano.jpg","tags":["panoramic","website"],"heightRatio":0.352919},{"name":"20240809_0062.jpg","tags":["archive","website"],"heightRatio":0.744348},{"name":"20240809_0096.jpg","tags":["archive","nyc","website"],"heightRatio":1},{"name":"20240809_0098.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240809_0126.jpg","tags":["archive","nyc","website"],"heightRatio":0.748135},{"name":"20240809_0127.jpg","tags":["archive","nyc","website"],"heightRatio":0.748018},{"name":"20240813_0001.jpg","tags":["archive","boston","website"],"heightRatio":1},{"name":"20240813_0004.jpg","tags":["archive","boston","website"],"heightRatio":0.992429},{"name":"20240813_0012.jpg","tags":["archive","boston","website"],"heightRatio":1},{"name":"20240813_0021.jpg","tags":["archive","boston","website"],"heightRatio":1},{"name":"20240813_0045.jpg","tags":["archive","nyc","website"],"heightRatio":1},{"name":"20240813_0064_pano.jpg","tags":["nyc","panoramic","website"],"heightRatio":0.352844},{"name":"20240813_0090.jpg","tags":["archive","nyc","website"],"heightRatio":0.748042},{"name":"20240829_0101.jpg","tags":["archive","nyc","website"],"heightRatio":1.33654},{"name":"20240829_0115.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0129.jpg","tags":["archive","nyc","website"],"heightRatio":1},{"name":"20240829_0143.jpg","tags":["archive","nyc","website"],"heightRatio":1.33673},{"name":"20240829_0148.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0149.jpg","tags":["archive","nyc","website"],"heightRatio":1.33641},{"name":"20240829_0150.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0167.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0169.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0182.jpg","tags":["archive","nyc","website"],"heightRatio":1.33629},{"name":"20240829_0184.jpg","tags":["archive","nyc","website"],"heightRatio":0.747925},{"name":"20240829_0198.jpg","tags":["archive","nyc","website"],"heightRatio":0.748252},{"name":"20240829_0208.jpg","tags":["archive","nyc","website"],"heightRatio":1},{"name":"20240829_0235.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"20240829_0240.jpg","tags":["archive","nyc","website"],"heightRatio":0.748276},{"name":"verrazzano.jpg","tags":["nyc","panoramic","website"],"heightRatio":0.352814},]

const params = new Proxy(new URLSearchParams(window.location.search), {
  get: (searchParams, prop) => searchParams.get(prop),
});
let queryTag = params.tag;
let archiveMonth = params.archive;

const photosDiv = document.getElementById("photos");
const col1 = document.getElementById("col1");
const col2 = document.getElementById("col2");
const cols = [col1, col2]
let colHeights = [0, 0]
let nextCol = 0

// fullover-component is expected to be included in DOM already
function displayFullover(imageComponent) {
    fulloverComponent = document.getElementById("fullover-component")
    fulloverComponent.setAttribute("src", imageComponent.getAttribute("src"))
    fulloverComponent.show()
}

function displayImage(img) {
    photo = document.createElement("photo-component")
    photo.setAttribute("src", "./img/"+img.name)
    cols[nextCol].appendChild(photo)
    colHeights[nextCol] += img.heightRatio
    if (cols.length == 2 && colHeights[nextCol] > colHeights[(nextCol + 1) % 2]) {
        nextCol = (nextCol + 1) % 2
    }
}

function hasTag(img, tag) {
    for (tagIdx = 0; tagIdx < img.tags.length; tagIdx++) {
        if (img.tags[tagIdx] == tag) {
            return true
        }
    }
    return false
}

// filters return true if the image should be filtered out
filters = [archiveMonthFilter, tagFilter, panoFilter]

function archiveMonthFilter(img) {
    if (archiveMonth != null) {
        if (!img.name.startsWith(archiveMonth) || !hasTag(img, "archive")) {
            return true
        }
    }
    return false
}

function tagFilter(img) {
    if (queryTag != null) {
        if (!hasTag(img, queryTag)) {
            return true
        }
    }
    return false
}

function panoFilter(img) {
    if (queryTag != "panoramic") {
        if (hasTag(img, "panoramic")) {
            return true
        }
    } else {
        if (!hasTag(img, "panoramic")) {
            return false
        }
    }
}

function main() {
    if (queryTag == "panoramic") {
        // make col1 full width
        col1.setAttribute("class", "full-width")
        // remove col2
        col2Idx = cols.indexOf(col2)
        cols.splice(col2Idx, 1)
        col2.remove()
    }

eachimg:
    for (i = 0; i < collection.length; i++) {
        for (filterIdx = 0; filterIdx < filters.length; filterIdx++) {
            if (filters[filterIdx](collection[i])) {
                continue eachimg
            }
        }
        displayImage(collection[i])
    }
}

main()
